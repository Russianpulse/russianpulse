database:
  override:
    - echo 'do nothing'

machine:
  services:
    - docker

test:
  pre:
    - docker-compose -f docker-compose.test.yml pull
    - docker-compose -f docker-compose.test.yml build
  override:
    - docker-compose -f docker-compose.test.yml run sut gem i bundler-audit
    - docker-compose -f docker-compose.test.yml run sut bundle-audit check --update
    - docker-compose -f docker-compose.test.yml run sut bundle exec rake db:create db:migrate spec

deployment:
  hub:
    branch: master
    commands:
      - docker build -t russianpulse/mazavr-engine .
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push russianpulse/mazavr-engine
      - ssh deployer@$DEPLOY_HOST "cd russianpulse && git pull && make"
